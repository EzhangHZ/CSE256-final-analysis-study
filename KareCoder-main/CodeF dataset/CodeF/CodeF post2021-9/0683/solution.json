["T = int(input())\nfor _ in range(T):\n    n = int(input())\n    a = list(map(int, input().strip().split()))\n\n    def process(h):\n        f = [0] * n\n        ptr = [-1] * n\n        for i in range(n):\n            ptr[i] = i - 1\n            while ptr[i] >= 0 and h[i] - h[ptr[i]] <= i - ptr[i]:\n                ptr[i] = ptr[ptr[i]]\n            count = min(i - ptr[i], h[i])\n            f[i] = (h[i] - count + 1 + h[i]) * count // 2 + (f[ptr[i]] if i >= 0 else 0)\n        return f\n    l = process(a)\n    r = process(a[::-1])[::-1]\n    s = sum(a)\n    best = s\n    for i in range(n):\n        best = min(best, s - (l[i] + r[i] - a[i]) + a[i])\n    print(best)", "T = int(input())\nfor _ in range(T):\n    n = int(input())\n    a = list(map(int, input().strip().split()))\n\n    def process(h):\n        f = [0] * n\n        ptr = [-1] * n\n        for i in range(n):\n            ptr[i] = i - 1\n            while ptr[i] >= 0 and h[i] - h[ptr[i]] <= i - ptr[i]:\n                ptr[i] = ptr[ptr[i]]\n            count = min(i - ptr[i], h[i])\n            f[i] = (h[i] - count + 1 + h[i]) * count // 2 + (f[ptr[i]] if i >= 0 else 0)\n        return f\n    l = process(a)\n    r = process(a[::-1])[::-1]\n    s = sum(a)\n    best = s\n    for i in range(n):\n        best = min(best, s - (l[i] + r[i] - a[i]) + a[i])\n    print(best)", "T = int(input())\nfor _ in range(T):\n    n = int(input())\n    a = list(map(int, input().strip().split()))\n\n    def process(h):\n        f = [0] * n\n        ptr = [-1] * n\n        for i in range(n):\n            ptr[i] = i - 1\n            while ptr[i] >= 0 and h[i] - h[ptr[i]] <= i - ptr[i]:\n                ptr[i] = ptr[ptr[i]]\n            count = min(i - ptr[i], h[i])\n            f[i] = (h[i] - count + 1 + h[i]) * count // 2 + (f[ptr[i]] if i >= 0 else 0)\n        return f\n    l = process(a)\n    r = process(a[::-1])[::-1]\n    s = sum(a)\n    best = s\n    for i in range(n):\n        best = min(best, s - (l[i] + r[i] - a[i]) + a[i])\n    print(best)"]